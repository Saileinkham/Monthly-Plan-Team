<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monthly Plan</title>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&family=Sarabun:wght@300;400;500;600&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Sidebar Navigation -->
    <div class="sidebar-nav" id="sidebarNav">
        <div class="sidebar-header">
            <div class="sidebar-logo" style="display: flex; align-items: center; justify-content: space-between; gap: 10px;">
                <div style="display: flex; align-items: center; gap: 10px;">
                    <span class="sidebar-logo-icon">üìã</span>
                    <span id="appNameDisplay">‡πÇ‡∏î‡∏°</span>
                </div>
                <button id="editAppNameBtn" onclick="editAppName()" style="background: rgba(255,255,255,0.1); border: none; color: var(--text-primary); padding: 6px 10px; border-radius: 6px; cursor: pointer; font-size: 0.9rem; transition: all 0.2s;" title="‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏≠‡∏û">‚úèÔ∏è</button>
            </div>
        </div>

        <div class="sidebar-menu">
            <!-- Dashboard -->
            <div class="sidebar-item active" onclick="navigateTo('dashboard')" data-section="dashboard">
                <div class="sidebar-item-content">
                    <span class="sidebar-item-icon">üè†</span>
                    <div class="sidebar-item-text">
                        <span class="sidebar-item-title">‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</span>
                        <span class="sidebar-item-desc">‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</span>
                    </div>
                </div>
                <span class="sidebar-item-badge" id="sidebarTotalTodos">0</span>
            </div>

            <!-- Today -->
            <div class="sidebar-item" onclick="navigateTo('today')" data-section="today">
                <div class="sidebar-item-content">
                    <span class="sidebar-item-icon">üìÖ</span>
                    <div class="sidebar-item-text">
                        <span class="sidebar-item-title">‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</span>
                        <span class="sidebar-item-desc">‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</span>
                    </div>
                </div>
                <span class="sidebar-item-badge warning" id="sidebarTodayTodos">0</span>
            </div>

            <!-- Upcoming -->
            <div class="sidebar-item" onclick="navigateTo('upcoming')" data-section="upcoming">
                <div class="sidebar-item-content">
                    <span class="sidebar-item-icon">üìÜ</span>
                    <div class="sidebar-item-text">
                        <span class="sidebar-item-title">5 ‡∏ß‡∏±‡∏ô‡∏Ç‡πâ‡∏≤‡∏á‡∏´‡∏ô‡πâ‡∏≤</span>
                        <span class="sidebar-item-desc">‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤</span>
                    </div>
                </div>
                <span class="sidebar-item-badge" id="sidebarUpcomingTodos">0</span>
            </div>

            <!-- Overdue -->
            <div class="sidebar-item" onclick="navigateTo('overdue')" data-section="overdue">
                <div class="sidebar-item-content">
                    <span class="sidebar-item-icon">‚ö†Ô∏è</span>
                    <div class="sidebar-item-text">
                        <span class="sidebar-item-title">‡πÄ‡∏•‡∏¢‡∏Å‡∏≥‡∏´‡∏ô‡∏î</span>
                        <span class="sidebar-item-desc">‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏£‡πà‡∏á‡∏ó‡∏≥</span>
                    </div>
                </div>
                <span class="sidebar-item-badge danger" id="sidebarOverdueTodos">0</span>
            </div>

            <div class="sidebar-divider"></div>

            <!-- Calendar -->
            <div class="sidebar-item" onclick="navigateTo('calendar')" data-section="calendar">
                <div class="sidebar-item-content">
                    <span class="sidebar-item-icon">üìä</span>
                    <div class="sidebar-item-text">
                        <span class="sidebar-item-title">‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô</span>
                        <span class="sidebar-item-desc">‡∏°‡∏∏‡∏°‡∏°‡∏≠‡∏á‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</span>
                    </div>
                </div>
            </div>

            <!-- Recurring -->
            <div class="sidebar-item" onclick="navigateTo('recurring')" data-section="recurring">
                <div class="sidebar-item-content">
                    <span class="sidebar-item-icon">üîÑ</span>
                    <div class="sidebar-item-text">
                        <span class="sidebar-item-title">‡∏á‡∏≤‡∏ô‡∏ó‡∏≥‡∏ã‡πâ‡∏≥</span>
                        <span class="sidebar-item-desc">‡∏á‡∏≤‡∏ô‡∏õ‡∏£‡∏∞‡∏à‡∏≥</span>
                    </div>
                </div>
                <span class="sidebar-item-badge" id="sidebarRecurringTodos">0</span>
            </div>

            <div class="sidebar-section-title">‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</div>

            <!-- Categories -->
            <div class="sidebar-item" onclick="navigateTo('work')" data-section="work">
                <div class="sidebar-item-content">
                    <span class="sidebar-item-icon">üíº</span>
                    <div class="sidebar-item-text">
                        <span class="sidebar-item-title">‡∏á‡∏≤‡∏ô</span>
                    </div>
                </div>
                <span class="sidebar-item-badge" id="sidebarWorkTodos">0</span>
            </div>

            <div class="sidebar-item" onclick="navigateTo('personal')" data-section="personal">
                <div class="sidebar-item-content">
                    <span class="sidebar-item-icon">üë§</span>
                    <div class="sidebar-item-text">
                        <span class="sidebar-item-title">‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß</span>
                    </div>
                </div>
                <span class="sidebar-item-badge" id="sidebarPersonalTodos">0</span>
            </div>

            <div class="sidebar-item" onclick="navigateTo('shopping')" data-section="shopping">
                <div class="sidebar-item-content">
                    <span class="sidebar-item-icon">üõí</span>
                    <div class="sidebar-item-text">
                        <span class="sidebar-item-title">‡∏ä‡πá‡∏≠‡∏õ‡∏õ‡∏¥‡πâ‡∏á</span>
                    </div>
                </div>
                <span class="sidebar-item-badge" id="sidebarShoppingTodos">0</span>
            </div>

            <div class="sidebar-item" onclick="navigateTo('health')" data-section="health">
                <div class="sidebar-item-content">
                    <span class="sidebar-item-icon">üí™</span>
                    <div class="sidebar-item-text">
                        <span class="sidebar-item-title">‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û</span>
                    </div>
                </div>
                <span class="sidebar-item-badge" id="sidebarHealthTodos">0</span>
            </div>

            <div class="sidebar-item" onclick="navigateTo('study')" data-section="study">
                <div class="sidebar-item-content">
                    <span class="sidebar-item-icon">üìö</span>
                    <div class="sidebar-item-text">
                        <span class="sidebar-item-title">‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</span>
                    </div>
                </div>
                <span class="sidebar-item-badge" id="sidebarStudyTodos">0</span>
            </div>

            <!-- Custom Categories (Dynamic) -->
            <div id="customCategoriesSidebar"></div>

            <div class="sidebar-divider"></div>

            <!-- Leave Report -->
            <div class="sidebar-item" onclick="navigateTo('leave-report')" data-section="leave-report">
                <div class="sidebar-item-content">
                    <span class="sidebar-item-icon">üèñÔ∏è</span>
                    <div class="sidebar-item-text">
                        <span class="sidebar-item-title">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ß‡∏±‡∏ô‡∏•‡∏≤</span>
                        <span class="sidebar-item-desc">‡∏î‡∏π‡∏™‡∏£‡∏∏‡∏õ‡∏ß‡∏±‡∏ô‡∏•‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏õ‡∏µ</span>
                    </div>
                </div>
                <span class="sidebar-badge" id="leaveYearlyCount">0</span>
            </div>

            <div class="sidebar-divider"></div>

            <!-- Completed -->
            <div class="sidebar-item" onclick="navigateTo('completed')" data-section="completed">
                <div class="sidebar-item-content">
                    <span class="sidebar-item-icon">‚úÖ</span>
                    <div class="sidebar-item-text">
                        <span class="sidebar-item-title">‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß</span>
                        <span class="sidebar-item-desc">‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡πÄ‡∏™‡∏£‡πá‡∏à</span>
                    </div>
                </div>
                <span class="sidebar-item-badge success" id="sidebarCompletedTodos">0</span>
            </div>

            <!-- Spacer to push settings to bottom -->
            <div style="flex: 1;"></div>

            <div class="sidebar-divider"></div>

            <!-- Management Tools in Sidebar -->
            <div class="sidebar-item" onclick="toggleExportMenu()" style="position: relative;">
                <div class="sidebar-item-content">
                    <span class="sidebar-item-icon">üì•</span>
                    <div class="sidebar-item-text">
                        <span class="sidebar-item-title">‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤/‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å</span>
                    </div>
                </div>
            </div>

            <div class="sidebar-item" onclick="clearCompleted()">
                <div class="sidebar-item-content">
                    <span class="sidebar-item-icon">üóëÔ∏è</span>
                    <div class="sidebar-item-text">
                        <span class="sidebar-item-title">‡∏•‡πâ‡∏≤‡∏á‡∏á‡∏≤‡∏ô‡πÄ‡∏™‡∏£‡πá‡∏à</span>
                    </div>
                </div>
            </div>

            <div class="sidebar-divider"></div>

            <div class="sidebar-item" onclick="logout()" id="sidebarLogoutItem">
                <div class="sidebar-item-content">
                    <span class="sidebar-item-icon">üö™</span>
                    <div class="sidebar-item-text">
                        <span class="sidebar-item-title">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</span>
                    </div>
                </div>
            </div>
            
            <!-- Settings moved to Top Bar -->
        </div>
    </div>

    <!-- Login Modal -->
    <div id="loginOverlay" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg-main); z-index: 10000; display: flex; align-items: center; justify-content: center;">
        <div style="background: var(--bg-card); padding: 40px; border-radius: 20px; box-shadow: var(--shadow-lg); width: 90%; max-width: 400px; text-align: center; border: 1px solid var(--border);">
            <div style="font-size: 3rem; margin-bottom: 20px;">üîí</div>
            <h2 style="margin-bottom: 10px; color: var(--text-primary);">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</h2>
            <p style="color: var(--text-secondary); margin-bottom: 30px;">Monthly Plan Management System</p>
            
            <div style="margin-bottom: 20px; text-align: left;">
                <label style="display: block; margin-bottom: 8px; font-weight: 500;">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</label>
                <input type="text" id="loginUsername" placeholder="username" style="width: 100%; padding: 12px; border-radius: 10px; border: 2px solid var(--border); background: var(--bg-main); color: var(--text-primary); font-size: 1rem;">
            </div>
            
            <div style="margin-bottom: 30px; text-align: left;">
                <label style="display: block; margin-bottom: 8px; font-weight: 500;">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label>
                <input type="password" id="loginPassword" placeholder="password" style="width: 100%; padding: 12px; border-radius: 10px; border: 2px solid var(--border); background: var(--bg-main); color: var(--text-primary); font-size: 1rem;">
            </div>
            
            <button onclick="handleLogin()" class="btn btn-primary" style="width: 100%; padding: 14px; font-size: 1.1rem; justify-content: center; margin-bottom: 15px;">
                ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
            </button>
            
            <div style="text-align: center; font-size: 0.9rem; color: var(--text-secondary);">
                Created by Chai Dome
            </div>
        </div>
    </div>

    <!-- Sidebar Toggle Button -->
    <div class="sidebar-toggle" id="sidebarToggle" onclick="toggleSidebar()">
        ‚ò∞
    </div>

    <!-- Main Menu Button (Gradient) -->
    <div id="mainMenuButton" onclick="openSettings()" style="position: fixed; top: 20px; left: 20px; width: 50px; height: 50px; background: linear-gradient(135deg, #a855f7, #ec4899); border-radius: 12px; display: flex; align-items: center; justify-content: center; cursor: pointer; z-index: 2000; box-shadow: 0 4px 10px rgba(0,0,0,0.2); transition: transform 0.2s;" onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
        <span style="color: white; font-size: 1.5rem;">‚ò∞</span>
    </div>

    <button id="topLogoutButton" class="top-logout-button" onclick="logout()" title="‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö">
        <span class="top-logout-icon">üö™</span>
    </button>

    <!-- Sidebar Overlay -->
    <div class="sidebar-overlay" id="sidebarOverlay" onclick="toggleSidebar()"></div>

    <!-- Main Wrapper -->
    <div class="main-wrapper" id="mainWrapper">
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="header-content">
                <!-- Logo and Title Section -->
                <div style="display: flex; flex-direction: column; align-items: center; gap: 15px; margin-bottom: 20px;">
                    <!-- Logo Upload (Hidden) -->
                    <!--
                    <div style="position: relative; cursor: pointer;" onclick="document.getElementById('logoUpload').click()">
                        <img id="appLogo" src="" alt="" style="max-width: 100px; max-height: 100px; border-radius: 50%; display: none; border: 4px solid var(--primary); box-shadow: var(--shadow-lg); transition: all 0.3s ease; object-fit: cover;">
                        <div id="logoPlaceholder" style="width: 100px; height: 100px; border-radius: 50%; background: linear-gradient(135deg, var(--primary), var(--secondary)); display: flex; align-items: center; justify-content: center; font-size: 2.5rem; border: 4px solid var(--primary); box-shadow: var(--shadow-lg); cursor: pointer; transition: all 0.3s ease;">
                            üìã
                        </div>
                        <div style="position: absolute; bottom: 0; right: 0; background: var(--primary); color: white; border-radius: 50%; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; box-shadow: var(--shadow); font-size: 1rem;">
                            üì∑
                        </div>
                        <input type="file" id="logoUpload" accept="image/*" style="display: none;" onchange="handleLogoUpload(event)">
                    </div>
                    -->
                    
                    <!-- Editable App Name & Header Image (Hidden) -->
                    <!--
                    <div style="text-align: center; display: flex; flex-direction: column; align-items: center; gap: 10px;">
                        <h1 id="appNameDisplay" style="cursor: pointer; display: inline-block; padding: 8px 16px; border-radius: 8px; transition: all 0.3s ease;" onclick="editAppName()" onmouseover="this.style.background='var(--bg-hover)'" onmouseout="this.style.background='transparent'">
                            üìã ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏á‡∏≤‡∏ô‡∏Ñ‡∏∏‡∏ì‡∏ä‡∏≤‡∏¢‡πÇ‡∏î‡∏°
                        </h1>
                        <input type="text" id="appNameInput" style="display: none; font-size: 2.5rem; font-weight: 700; font-family: 'Kanit', sans-serif; text-align: center; border: 2px solid var(--primary); border-radius: 12px; padding: 10px; width: 90%; max-width: 500px; background: var(--bg-card);" onblur="saveAppName()" onkeypress="if(event.key==='Enter') saveAppName()">
                        
                        <div style="position: relative; width: 100%; max-width: 600px; margin: 0 auto;">
                            <img id="headerImage" src="" alt="" style="width: 100%; height: auto; border-radius: 12px; display: none; box-shadow: var(--shadow); object-fit: cover;">
                            <div class="header-image-placeholder" id="headerImagePlaceholder" onclick="document.getElementById('headerImageUpload').click()" style="width: 100%; height: 150px; border-radius: 12px; background: var(--bg-card); border: 2px dashed var(--border); display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; transition: all 0.3s;">
                                <span style="font-size: 2rem;">üñºÔ∏è</span>
                                <span style="margin-top: 8px; color: var(--text-secondary);">‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏õ‡∏Å</span>
                            </div>
                            <button onclick="document.getElementById('headerImageUpload').click()" style="position: absolute; top: 10px; right: 10px; background: rgba(0,0,0,0.5); color: white; border: none; padding: 8px; border-radius: 50%; cursor: pointer; backdrop-filter: blur(4px);">
                                üì∑
                            </button>
                            <input type="file" id="headerImageUpload" accept="image/*" style="display: none;" onchange="handleHeaderImageUpload(event)">
                        </div>

                        <p>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏°‡∏∑‡∏≠‡∏≠‡∏≤‡∏ä‡∏µ‡∏û</p>
                    </div>
                    -->
                    
                    <!-- Simplified Title -->
                    <h1 style="text-align: center;">Monthly Plan</h1>
                    <div id="adminControlsDisplay" style="margin-top: 10px;"></div>
                </div>
                
                <div class="header-stats">
                    <div class="stat-item">
                        <div class="stat-value" id="totalTodos">0</div>
                        <div class="stat-label">‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="completedTodos">0</div>
                        <div class="stat-label">‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="pendingTodos">0</div>
                        <div class="stat-label">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏™‡∏£‡πá‡∏à</div>
                    </div>
                </div>
                
                <!-- Progress Bar -->
                <div class="progress-container">
                    <div class="progress-label">
                        <span class="progress-text">üéØ ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤</span>
                        <span class="progress-percentage" id="progressPercentage">0%</span>
                    </div>
                    <div class="progress-bar-bg">
                        <div class="progress-bar-fill" id="progressBarFill" style="width: 0%"></div>
                    </div>
                    <div class="progress-details">
                        <div class="progress-detail-item">
                            <span>‚úÖ</span>
                            <span id="completedCount">0</span>
                            <span>/</span>
                            <span id="totalCount">0</span>
                            <span>‡∏á‡∏≤‡∏ô</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Dashboard Summary -->
        <div class="dashboard-summary" id="dashboardSummary">
            <!-- Month Summary -->
            <div class="summary-card">
                <div class="summary-card-header">
                    <div class="summary-card-title">
                        <span class="summary-card-icon">üìÖ</span>
                        <span>‡∏á‡∏≤‡∏ô‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</span>
                    </div>
                    <div class="summary-card-total" id="monthTotalTasks">0</div>
                </div>
                <div class="summary-card-body">
                    <div class="summary-item">
                        <div class="summary-item-label">
                            <span>‚úÖ</span>
                            <span>‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß</span>
                        </div>
                        <div class="summary-item-value" style="color: var(--success);" id="monthCompletedTasks">0</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-item-label">
                            <span>‚è≥</span>
                            <span>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏≥</span>
                        </div>
                        <div class="summary-item-value" style="color: var(--warning);" id="monthPendingTasks">0</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-item-label">
                            <span>‚ö†Ô∏è</span>
                            <span>‡πÄ‡∏•‡∏¢‡∏Å‡∏≥‡∏´‡∏ô‡∏î</span>
                        </div>
                        <div class="summary-item-value" style="color: var(--danger);" id="monthOverdueTasks">0</div>
                    </div>
                </div>
            </div>

            <!-- Work Time Summary -->
            <div class="summary-card" id="workTimeSummaryCard">
                <div class="summary-card-header">
                    <div class="summary-card-title">
                        <span class="summary-card-icon">üïò</span>
                        <span id="branchSummaryTitle">‡∏™‡∏£‡∏∏‡∏õ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏á‡∏≤‡∏ô</span>
                    </div>
                </div>
                <div class="summary-card-body" id="branchSummary" style="font-size: 1rem;">
                    <!-- Will be populated by JS -->
                </div>
            </div>

            <!-- Leave Summary -->
            <div class="summary-card">
                <div class="summary-card-header">
                    <div class="summary-card-title">
                        <span class="summary-card-icon">üèñÔ∏è</span>
                        <span>‡∏ß‡∏±‡∏ô‡∏•‡∏≤‡πÅ‡∏•‡∏∞‡∏´‡∏¢‡∏∏‡∏î</span>
                    </div>
                </div>
                <div class="summary-card-body">
                    <div class="summary-item">
                        <div class="summary-item-label">
                            <span>üèñÔ∏è</span>
                            <span>Day Off</span>
                        </div>
                        <div class="summary-item-value" id="summaryDayOff">0</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-item-label">
                            <span>üéâ</span>
                            <span>‡∏•‡∏≤‡∏ô‡∏±‡∏Å‡∏Ç‡∏±‡∏ï‡∏§‡∏Å‡∏©‡πå</span>
                        </div>
                        <div class="summary-item-value" id="summaryHoliday">0</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-item-label">
                            <span>üèùÔ∏è</span>
                            <span>‡∏•‡∏≤‡∏û‡∏±‡∏Å‡∏£‡πâ‡∏≠‡∏ô</span>
                        </div>
                        <div class="summary-item-value" id="summaryVacation">0</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-item-label">
                            <span>ü§í</span>
                            <span>‡∏•‡∏≤‡∏õ‡πà‡∏ß‡∏¢</span>
                        </div>
                        <div class="summary-item-value" id="summarySick">0</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-item-label">
                            <span>üìù</span>
                            <span>‡∏•‡∏≤‡∏Å‡∏¥‡∏à</span>
                        </div>
                        <div class="summary-item-value" id="summaryPersonal">0</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Controls -->
        <div class="controls">
            <div class="controls-top">
                <div class="search-box">
                    <input type="text" id="searchInput" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏á‡∏≤‡∏ô...">
                </div>
                <div class="view-toggle">
                    <button class="view-btn active" onclick="switchView('list')">üìã ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</button>
                    <button class="view-btn" onclick="switchView('calendar')">üìÖ ‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô</button>
                </div>
                <div class="notification-bell" onclick="toggleNotifications()" style="position: relative;">
                    <button class="btn btn-secondary" style="padding: 12px 16px;">
                        üîî <span id="notificationCount"></span>
                    </button>
                    <span class="notification-badge" id="notificationBadge" style="display: none;">0</span>
                </div>
                <!-- Settings moved to Main Menu Button -->
                <!-- Export Menu moved to Sidebar -->
                <!-- Clear Completed moved to Sidebar -->
            </div>
            <input type="file" id="importFile" class="file-input-hidden" accept=".xlsx,.xls,.csv" onchange="importFile(event)">
            <div class="filters">
                <button class="filter-btn active" data-filter="all" onclick="filterTodos('all')">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
                <button class="filter-btn" data-filter="active" onclick="filterTodos('active')">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏™‡∏£‡πá‡∏à</button>
                <button class="filter-btn" data-filter="completed" onclick="filterTodos('completed')">‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß</button>
                <button class="filter-btn" data-filter="high" onclick="filterTodos('high')">üî¥ ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏°‡∏≤‡∏Å</button>
                <button class="filter-btn" data-filter="medium" onclick="filterTodos('medium')">üü° ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á</button>
                <button class="filter-btn" data-filter="low" onclick="filterTodos('low')">üü¢ ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏ô‡πâ‡∏≠‡∏¢</button>
                <select id="branchFilter" onchange="filterTodos('branch:' + this.value)" style="padding: 8px 12px; border-radius: 20px; border: 2px solid var(--border); font-size: 0.9rem; background: var(--bg-main); color: var(--text-primary); cursor: pointer; transition: all 0.3s;">
                    <option value="">üè¢ ‡∏Å‡∏£‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡∏™‡∏≤‡∏Ç‡∏≤</option>
                    <!-- Populated by JS -->
                </select>
            </div>
        </div>

        <!-- Search & Quick Actions Bar -->
        <div style="background: var(--bg-card); padding: 20px; border-radius: 16px; margin-bottom: 20px; box-shadow: var(--shadow);">
            <div style="display: flex; gap: 12px; flex-wrap: wrap; align-items: center;">
                <!-- Search Box -->
                <div style="flex: 1; min-width: 250px; position: relative;">
                    <input 
                        type="text" 
                        id="searchInput" 
                        placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏á‡∏≤‡∏ô..."
                        onkeyup="searchTodos()"
                        style="width: 100%; padding: 12px 40px 12px 16px; border: 2px solid var(--border); border-radius: 12px; font-size: 1rem; transition: all 0.3s;"
                    >
                    <button 
                        onclick="clearSearch()" 
                        id="clearSearchBtn"
                        style="position: absolute; right: 8px; top: 50%; transform: translateY(-50%); background: transparent; border: none; color: var(--text-secondary); cursor: pointer; padding: 4px 8px; display: none;"
                        title="‡∏•‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤"
                    >‚úï</button>
                </div>
                
                <!-- Quick Actions -->
                <button onclick="exportToCSV()" class="btn" style="background: linear-gradient(135deg, #10b981, #059669); white-space: nowrap; padding: 12px 20px;">
                    üì§ Export CSV
                </button>
                <button onclick="showStatsModal()" class="btn" style="background: linear-gradient(135deg, #8b5cf6, #7c3aed); white-space: nowrap; padding: 12px 20px;">
                    üìä ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥
                </button>
                <button onclick="toggleAllCompleted()" class="btn" style="background: linear-gradient(135deg, #f59e0b, #d97706); white-space: nowrap; padding: 12px 20px;">
                    ‚úÖ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                </button>
            </div>
        </div>

        <!-- Add Todo Form -->
        <div class="add-todo-form">
            <!-- Branch Visit Entry (Now at top - Primary function) -->
            <div class="branch-visit-section" id="branchVisitSection" style="margin-top: 0; margin-bottom: 20px;">
                <div class="branch-visit-title">
                    üïò ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡∏á‡∏≤‡∏ô
                    <span style="font-size: 0.75rem; font-weight: 400; color: var(--text-secondary);">(‡∏£‡∏∞‡∏ö‡∏∏‡∏ß‡∏±‡∏ô‡πÅ‡∏•‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤-‡∏≠‡∏≠‡∏Å‡∏á‡∏≤‡∏ô)</span>
                </div>
                <div class="branch-visit-form">
                    <div id="branchVisitBranchGroup" style="display: none;">
                        <label style="font-size: 0.85rem; font-weight: 600; margin-bottom: 4px; display: block;">‡∏™‡∏≤‡∏Ç‡∏≤</label>
                        <select id="branchVisitBranch" style="width: 100%; padding: 10px; border: 2px solid var(--border); border-radius: 10px; background: var(--bg-main); color: var(--text-primary);">
                            <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏≤‡∏Ç‡∏≤ --</option>
                        </select>
                    </div>
                    <div id="branchVisitUserActionGroup" style="display: none;">
                        <label style="font-size: 0.85rem; font-weight: 600; margin-bottom: 4px; display: block;">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</label>
                        <select id="branchVisitUserAction" onchange="toggleBranchVisitTimeInputs()" style="width: 100%; padding: 10px; border: 2px solid var(--border); border-radius: 10px; background: var(--bg-main); color: var(--text-primary);">
                            <option value="work">‚úÖ ‡πÄ‡∏Ç‡πâ‡∏≤‡∏á‡∏≤‡∏ô (‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏ß‡∏•‡∏≤)</option>
                            <option value="dayoff">üèñÔ∏è Day Off</option>
                            <option value="holiday">üéâ ‡∏•‡∏≤‡∏ô‡∏±‡∏Å‡∏Ç‡∏±‡∏ï‡∏§‡∏Å‡∏©‡πå</option>
                            <option value="vacation">üèùÔ∏è ‡∏•‡∏≤‡∏û‡∏±‡∏Å‡∏£‡πâ‡∏≠‡∏ô</option>
                            <option value="sick">ü§í ‡∏•‡∏≤‡∏õ‡πà‡∏ß‡∏¢</option>
                            <option value="personal">üìù ‡∏•‡∏≤‡∏Å‡∏¥‡∏à</option>
                        </select>
                    </div>
                    <div>
                        <label style="font-size: 0.85rem; font-weight: 600; margin-bottom: 4px; display: block;">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label>
                        <input type="date" id="branchVisitDate" style="width: 100%; padding: 10px; border: 2px solid var(--border); border-radius: 10px;">
                    </div>
                    <div>
                        <label style="font-size: 0.85rem; font-weight: 600; margin-bottom: 4px; display: block;">‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤</label>
                        <input type="time" id="branchVisitTime" style="width: 100%; padding: 10px; border: 2px solid var(--border); border-radius: 10px;">
                    </div>
                    <div>
                        <label style="font-size: 0.85rem; font-weight: 600; margin-bottom: 4px; display: block;">‡πÄ‡∏ß‡∏•‡∏≤‡∏≠‡∏≠‡∏Å</label>
                        <input type="time" id="branchVisitTimeOut" style="width: 100%; padding: 10px; border: 2px solid var(--border); border-radius: 10px;">
                    </div>
                    <button class="btn btn-primary" onclick="addBranchVisit()" style="white-space: nowrap;">
                        ‚ûï ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
                    </button>
                </div>
                <div id="userBranchVisitQuickActions" style="display: none; margin-top: 12px; gap: 10px; flex-wrap: wrap;">
                    <button class="btn btn-primary" onclick="quickCheckIn()" style="background: linear-gradient(135deg, #10b981, #059669);">
                        ‚úÖ ‡πÄ‡∏Ç‡πâ‡∏≤‡∏á‡∏≤‡∏ô‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ
                    </button>
                    <button class="btn btn-secondary" onclick="quickCheckOut()" style="border-color: rgba(239, 68, 68, 0.35); color: #ef4444;">
                        üö™ ‡∏≠‡∏≠‡∏Å‡∏á‡∏≤‡∏ô‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ
                    </button>
                </div>
            </div>

            <!-- Add Task Buttons -->
            <div id="todoInputSection" style="display: flex; justify-content: center; gap: 12px; margin-bottom: 20px; flex-wrap: wrap;">
                <button class="btn btn-primary" onclick="toggleBulkAdd()" style="font-size: 1.1rem; padding: 14px 30px;">
                    üìù ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô (Bulk Add)
                </button>
                <button class="btn btn-primary" onclick="openAddTodoModal()" style="font-size: 1.1rem; padding: 14px 30px; background: linear-gradient(135deg, #10b981, #059669);">
                    ‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß
                </button>
            </div>

            <!-- Bulk Add Tasks -->
            <div class="bulk-add-container" id="bulkAddContainer">
                <div class="bulk-add-header">
                    <div class="bulk-add-title">‚ú® ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏•‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ô</div>
                </div>

                <div class="bulk-add-help">
                    üí° <strong>‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ:</strong> ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏á‡∏≤‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏±‡πà‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡πÉ‡∏´‡∏°‡πà (Enter)<br>
                    üìå ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö: <code>‡∏á‡∏≤‡∏ô | ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç | ‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà | ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà | ‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏° | ‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î | ‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô</code><br>
                    üé® <strong>‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô:</strong> ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏™‡πà emoji ‡∏ó‡πâ‡∏≤‡∏¢‡∏™‡∏∏‡∏î‡πÑ‡∏î‡πâ ‡πÄ‡∏ä‡πà‡∏ô üî• üìä üí™ üè†<br>
                    üìã <strong>‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á:</strong> <code>‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡∏ó‡∏µ‡∏° | high | work | 2026-01-27 | 09:00 | 11:00 | üìä</code>
                </div>

                <textarea 
                    id="bulkTaskInput" 
                    class="bulk-textarea" 
                    placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏á‡∏≤‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ (‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 1 ‡∏á‡∏≤‡∏ô)

‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á:
‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡∏ó‡∏µ‡∏° | high | work | 2026-01-28 | 09:00 | 11:00 | üìä
‡∏™‡πà‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô | high | work | 2026-01-28 | 14:00 | | üìÑ
‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏≠‡∏á | medium | shopping | | | | üõí
‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢ | high | health | 2026-01-27 | 06:00 | 07:00 | üí™
‡∏ó‡∏≥‡∏á‡∏≤‡∏ô | medium | work | 2026-01-27 | 09:00 | 18:00 | üî•

‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÄ‡∏ï‡πá‡∏° (‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö):
‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ö‡πâ‡∏≤‡∏ô | low | personal | 2026-01-30 | 10:00 | 12:00 | üè†"
                    oninput="updateBulkPreview()"
                ></textarea>

                <div class="bulk-settings">
                    <div class="bulk-setting">
                        <label>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô</label>
                        <select id="bulkDefaultPriority">
                            <option value="low">üü¢ ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏ô‡πâ‡∏≠‡∏¢</option>
                            <option value="medium" selected>üü° ‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á</option>
                            <option value="high">üî¥ ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏°‡∏≤‡∏Å</option>
                        </select>
                    </div>

                    <div class="bulk-setting">
                        <label>
                            ‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
                            <button id="quickManageCategoriesBtn" onclick="openQuickManageCategories()" style="background: transparent; border: 1px solid var(--primary); color: var(--primary); padding: 2px 8px; border-radius: 4px; cursor: pointer; font-size: 0.75rem; margin-left: 8px;" title="‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà">‚öôÔ∏è ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</button>
                        </label>
                        <select id="bulkDefaultCategory">
                            <option value="personal" selected>üë§ ‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß</option>
                            <option value="work">üíº ‡∏á‡∏≤‡∏ô</option>
                            <option value="shopping">üõí ‡∏ä‡πá‡∏≠‡∏õ‡∏õ‡∏¥‡πâ‡∏á</option>
                            <option value="health">üí™ ‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û</option>
                            <option value="study">üìö ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</option>
                        </select>
                    </div>

                    <div class="bulk-setting">
                        <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô</label>
                        <input type="date" id="bulkDefaultDate">
                    </div>

                    <div class="bulk-setting">
                        <label>üé® ‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô</label>
                        <div class="emoji-picker-container">
                            <div class="emoji-input-wrapper">
                                <div class="emoji-display" id="bulkEmojiDisplay" onclick="toggleEmojiPicker('bulk')"></div>
                                <button class="btn btn-secondary" onclick="clearBulkEmoji()" style="padding: 8px 12px;">üóëÔ∏è</button>
                            </div>
                            <div class="emoji-picker-popup" id="bulkEmojiPicker">
                                <div class="emoji-picker-header">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô</div>
                                <div class="emoji-grid" id="bulkEmojiGrid">
                                    <!-- Populated by JS -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="bulk-preview" id="bulkPreview" style="display: none;">
                    <div class="bulk-preview-title">
                        üìã ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: <span class="bulk-count" id="bulkCount">0</span> ‡∏á‡∏≤‡∏ô
                    </div>
                    <div class="bulk-preview-list" id="bulkPreviewList">
                        <!-- Preview items will be added here -->
                    </div>
                </div>

                <div class="bulk-actions">
                    <button class="btn btn-primary" onclick="addBulkTasks()">
                        ‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (<span id="bulkAddCount">0</span> ‡∏á‡∏≤‡∏ô)
                    </button>
                    <button class="btn btn-secondary" onclick="clearBulkInput()">
                        üóëÔ∏è ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
                    </button>
                    <button class="btn btn-secondary" onclick="toggleBulkAdd()">
                        ‚úï ‡∏õ‡∏¥‡∏î
                    </button>
                </div>
            </div>

            <!-- Recurring Options -->
            <div class="recurring-toggle" onclick="toggleRecurringOptions()">
                <input type="checkbox" id="recurringCheckbox" onclick="event.stopPropagation()">
                <label for="recurringCheckbox">üîÑ ‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏ã‡πâ‡∏≥ (Recurring Task)</label>
            </div>

            <div class="recurring-options" id="recurringOptions">
                <div class="recurring-config">
                    <div class="recurring-field">
                        <label>‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏ã‡πâ‡∏≥</label>
                        <select id="recurringType" onchange="updateRecurringConfig()">
                            <option value="daily">‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô</option>
                            <option value="weekly">‡∏ó‡∏∏‡∏Å‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå</option>
                            <option value="monthly">‡∏ó‡∏∏‡∏Å‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</option>
                            <option value="weekdays">‡∏ß‡∏±‡∏ô‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå-‡∏®‡∏∏‡∏Å‡∏£‡πå</option>
                            <option value="weekends">‡∏ß‡∏±‡∏ô‡πÄ‡∏™‡∏≤‡∏£‡πå-‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå</option>
                            <option value="custom">‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏≠‡∏á</option>
                        </select>
                    </div>

                    <div class="recurring-field" id="intervalField">
                        <label>‡∏ó‡∏≥‡∏ã‡πâ‡∏≥‡∏ó‡∏∏‡∏Å‡∏Å‡∏µ‡πà‡∏ß‡∏±‡∏ô/‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</label>
                        <input type="number" id="recurringInterval" value="1" min="1" max="365" onchange="updateRecurringPreview()">
                    </div>

                    <div class="recurring-field" style="grid-column: 1 / -1;" id="weekdayField" style="display: none;">
                        <label>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô</label>
                        <div class="weekday-selector">
                            <button type="button" class="weekday-btn" data-day="0" onclick="toggleWeekday(0)">‡∏≠‡∏≤</button>
                            <button type="button" class="weekday-btn" data-day="1" onclick="toggleWeekday(1)">‡∏à</button>
                            <button type="button" class="weekday-btn" data-day="2" onclick="toggleWeekday(2)">‡∏≠</button>
                            <button type="button" class="weekday-btn" data-day="3" onclick="toggleWeekday(3)">‡∏û</button>
                            <button type="button" class="weekday-btn" data-day="4" onclick="toggleWeekday(4)">‡∏û‡∏§</button>
                            <button type="button" class="weekday-btn" data-day="5" onclick="toggleWeekday(5)">‡∏®</button>
                            <button type="button" class="weekday-btn" data-day="6" onclick="toggleWeekday(6)">‡∏™</button>
                        </div>
                    </div>

                    <div class="recurring-field">
                        <label>‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏à‡∏≤‡∏Å</label>
                        <input type="date" id="recurringStartDate">
                    </div>

                    <div class="recurring-field">
                        <label>‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)</label>
                        <input type="date" id="recurringEndDate">
                    </div>
                </div>

                <div class="recurring-preview" id="recurringPreview">
                    <div class="recurring-preview-title">üìã ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á:</div>
                    <div id="recurringPreviewText">‡∏á‡∏≤‡∏ô‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏ó‡∏≥‡∏ã‡πâ‡∏≥‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô</div>
                </div>
            </div>
        </div>

        <!-- Week Plan -->
        <div class="week-plan" id="weekPlan">
            <div class="week-plan-header">
                <h2 class="week-plan-title">üìÖ 5 ‡∏ß‡∏±‡∏ô‡∏Ç‡πâ‡∏≤‡∏á‡∏´‡∏ô‡πâ‡∏≤</h2>
                <div style="display: flex; gap: 10px;">
                    <button class="btn btn-secondary" onclick="showDebugInfo()">üîç Debug</button>
                    <button class="btn btn-secondary" onclick="refreshWeekPlan()">üîÑ ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä</button>
                </div>
            </div>
            <div class="week-days" id="weekDays">
                <!-- Will be populated by JavaScript -->
            </div>
        </div>

        <!-- Debug Panel -->
        <div id="debugPanel" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: var(--bg-card); padding: 30px; border-radius: 20px; box-shadow: var(--shadow-lg); z-index: 9999; max-width: 90%; max-height: 80vh; overflow-y: auto;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3 style="font-family: 'Kanit', sans-serif; font-size: 1.5rem;">üîç Debug: ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>
                <button class="close-btn" onclick="closeDebugPanel()">‚úï</button>
            </div>
            <div id="debugContent"></div>
        </div>
        <div id="debugBackdrop" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 9998;" onclick="closeDebugPanel()"></div>

        <!-- Notification Panel -->
        <div class="notification-panel" id="notificationPanel">
            <div class="notification-header">
                <div class="notification-title">üîî ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</div>
                <button class="notification-close" onclick="toggleNotifications()">‚úï</button>
            </div>
            <div class="notification-list" id="notificationList">
                <!-- Will be populated by JavaScript -->
            </div>
        </div>

        <!-- Todo Sections -->
        <div class="todo-sections" id="todoSections">
            <!-- Will be populated by JavaScript -->
        </div>

        <!-- Calendar View -->
        <div class="calendar-container" id="calendarView">
            <!-- Calendar Stats -->
            <div class="calendar-stats">
                <div class="calendar-stat-card">
                    <div class="calendar-stat-icon">üìÖ</div>
                    <div class="calendar-stat-value" id="calMonthTodos">0</div>
                    <div class="calendar-stat-label">‡∏á‡∏≤‡∏ô‡πÉ‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</div>
                </div>
                <div class="calendar-stat-card">
                    <div class="calendar-stat-icon">‚úÖ</div>
                    <div class="calendar-stat-value" id="calMonthCompleted">0</div>
                    <div class="calendar-stat-label">‡∏ó‡∏≥‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß</div>
                </div>
                <div class="calendar-stat-card">
                    <div class="calendar-stat-icon">‚è≥</div>
                    <div class="calendar-stat-value" id="calMonthPending">0</div>
                    <div class="calendar-stat-label">‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</div>
                </div>
                <div class="calendar-stat-card">
                    <div class="calendar-stat-icon">üèñÔ∏è</div>
                    <div class="calendar-stat-value" id="calMonthDayOff">0</div>
                    <div class="calendar-stat-label">‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î</div>
                </div>
            </div>

            <div class="calendar-header">
                <h2 class="calendar-title" id="calendarMonth">‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏° 2026</h2>
                <div class="calendar-nav">
                    <button class="nav-btn" onclick="previousMonth()">‚óÄ</button>
                    <button class="nav-btn" onclick="todayMonth()">‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</button>
                    <button class="nav-btn" onclick="nextMonth()">‚ñ∂</button>
                </div>
            </div>

            <!-- Legend -->
            <div class="calendar-legend">
                <div class="legend-item">
                    <div class="legend-color today"></div>
                    <span>‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color has-todos"></div>
                    <span>‡∏°‡∏µ‡∏á‡∏≤‡∏ô</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color day-off"></div>
                    <span>‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color overdue"></div>
                    <span>‡πÄ‡∏•‡∏¢‡∏Å‡∏≥‡∏´‡∏ô‡∏î</span>
                </div>
            </div>

            <div class="calendar-grid" id="calendarGrid">
                <!-- Will be populated by JavaScript -->
            </div>
        </div>

        <!-- Calendar Modal -->
        <div class="calendar-modal" id="calendarModal" onclick="closeModal(event)">
            <div class="modal-content" onclick="event.stopPropagation()">
                <div class="modal-header">
                    <h3 class="modal-title" id="modalDate">‡∏á‡∏≤‡∏ô‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà...</h3>
                    <button class="close-btn" onclick="closeModal()">‚úï</button>
                </div>
                
                <!-- Leave Type Selection -->
                <div id="leaveTypeSection" style="margin-bottom: 20px; padding: 15px; background: var(--bg-main); border-radius: 12px;">
                    <div style="font-weight: 600; margin-bottom: 10px; color: var(--text-primary);">üèñÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ß‡∏±‡∏ô‡∏•‡∏≤/‡∏´‡∏¢‡∏∏‡∏î</div>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 10px;">
                        <label class="leave-type-option">
                            <input type="radio" name="leaveType" value="" checked onchange="handleLeaveTypeChange()">
                            <span>‚úÖ ‡∏ß‡∏±‡∏ô‡∏ó‡∏≥‡∏á‡∏≤‡∏ô</span>
                        </label>
                        <label class="leave-type-option">
                            <input type="radio" name="leaveType" value="dayoff" onchange="handleLeaveTypeChange()">
                            <span>üèñÔ∏è Day Off</span>
                        </label>
                        <label class="leave-type-option">
                            <input type="radio" name="leaveType" value="holiday" onchange="handleLeaveTypeChange()">
                            <span>üéâ ‡∏•‡∏≤‡∏ô‡∏±‡∏Å‡∏Ç‡∏±‡∏ï‡∏§‡∏Å‡∏©‡πå</span>
                        </label>
                        <label class="leave-type-option">
                            <input type="radio" name="leaveType" value="vacation" onchange="handleLeaveTypeChange()">
                            <span>üèùÔ∏è ‡∏•‡∏≤‡∏û‡∏±‡∏Å‡∏£‡πâ‡∏≠‡∏ô</span>
                        </label>
                        <label class="leave-type-option">
                            <input type="radio" name="leaveType" value="sick" onchange="handleLeaveTypeChange()">
                            <span>ü§í ‡∏•‡∏≤‡∏õ‡πà‡∏ß‡∏¢</span>
                        </label>
                        <label class="leave-type-option">
                            <input type="radio" name="leaveType" value="personal" onchange="handleLeaveTypeChange()">
                            <span>üìù ‡∏•‡∏≤‡∏Å‡∏¥‡∏à</span>
                        </label>
                    </div>
                </div>

                <!-- Admin All View User Status List -->
                <div id="adminUserStatusSection" style="display: none; margin-bottom: 20px; padding: 15px; background: var(--bg-main); border-radius: 12px;">
                    <div style="font-weight: 600; margin-bottom: 10px; color: var(--text-primary);">üë• ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ß‡∏±‡∏ô‡∏•‡∏≤/‡∏´‡∏¢‡∏∏‡∏î‡∏£‡∏≤‡∏¢‡∏Ñ‡∏ô</div>
                    <div id="adminUserStatusList" style="display: flex; flex-direction: column; gap: 8px;">
                        <!-- Will be populated by JS -->
                    </div>
                </div>
                
                <div class="todo-list" id="modalTodos">
                    <!-- Will be populated by JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <!-- Theme Toggle -->
    <div class="theme-toggle" onclick="toggleTheme()">
        <span id="themeIcon">üåô</span>
    </div>

    <!-- Edit Todo Modal -->
    <div class="edit-modal" id="editModal" onclick="closeEditModal(event)">
        <div class="edit-modal-content" onclick="event.stopPropagation()">
            <div class="edit-modal-header">
                <h3 class="edit-modal-title">‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏á‡∏≤‡∏ô</h3>
                <button class="close-btn" onclick="closeEditModal()">‚úï</button>
            </div>

            <div class="edit-form-group">
                <label class="edit-form-label">‡∏ä‡∏∑‡πà‡∏≠‡∏á‡∏≤‡∏ô</label>
                <textarea id="editTodoText" class="edit-form-textarea" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏á‡∏≤‡∏ô..."></textarea>
            </div>

            <div class="edit-form-group" id="editTodoCreatorGroup" style="display: none;">
                <label class="edit-form-label">‡∏ú‡∏π‡πâ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏á‡∏≤‡∏ô</label>
                <select id="editTodoCreatedBy" class="edit-form-select"></select>
            </div>

            <div class="edit-form-row">
                <div class="edit-form-group">
                    <label class="edit-form-label">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç</label>
                    <select id="editTodoPriority" class="edit-form-select">
                        <option value="low">üü¢ ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏ô‡πâ‡∏≠‡∏¢</option>
                        <option value="medium">üü° ‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á</option>
                        <option value="high">üî¥ ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏°‡∏≤‡∏Å</option>
                    </select>
                </div>

                <div class="edit-form-group">
                    <label class="edit-form-label">‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</label>
                    <select id="editTodoCategory" class="edit-form-select">
                        <option value="personal">üë§ ‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß</option>
                        <option value="work">üíº ‡∏á‡∏≤‡∏ô</option>
                        <option value="shopping">üõí ‡∏ä‡πá‡∏≠‡∏õ‡∏õ‡∏¥‡πâ‡∏á</option>
                        <option value="health">üí™ ‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û</option>
                        <option value="study">üìö ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</option>
                    </select>
                </div>
            </div>

            <div class="edit-form-group">
                <label class="edit-form-label">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label>
                <input type="date" id="editTodoDate" class="edit-form-input">
            </div>

            <div class="edit-form-group">
                <label class="edit-form-label">‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤</label>
                <div class="edit-form-time-group">
                    <div>
                        <label class="edit-form-label" style="font-size: 0.8rem; margin-bottom: 4px;">‡πÄ‡∏£‡∏¥‡πà‡∏°</label>
                        <input type="time" id="editTodoTimeStart" class="edit-form-input">
                    </div>
                    <div>
                        <label class="edit-form-label" style="font-size: 0.8rem; margin-bottom: 4px;">‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î</label>
                        <input type="time" id="editTodoTimeEnd" class="edit-form-input">
                    </div>
                </div>
            </div>

            <div class="edit-form-group">
                <label class="edit-form-label">üè¢ ‡∏™‡∏≤‡∏Ç‡∏≤ (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ‡∏´‡∏•‡∏≤‡∏¢‡∏™‡∏≤‡∏Ç‡∏≤)</label>
                <div class="branch-grid" id="editBranchGrid">
                    <!-- Will be populated by JS -->
                </div>
            </div>

            <div class="edit-modal-actions">
                <button class="btn btn-primary" onclick="saveEditedTodo()" style="flex: 1;">
                    üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
                </button>
                <button class="btn btn-secondary" onclick="closeEditModal()">
                    ‚úï ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                </button>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div class="settings-modal" id="settingsModal" onclick="closeSettings(event)">
        <div class="settings-modal-content" onclick="event.stopPropagation()" style="background: var(--bg-main); padding: 20px; border-radius: 20px; max-width: 600px;">
            <div style="display: flex; justify-content: flex-end; margin-bottom: 10px;">
                <button class="close-btn" onclick="closeSettings()">‚úï</button>
            </div>

            <!-- User Management Card (Admin Only) -->
            <div id="settingsUserSection" style="display: none; background: white; border-radius: 16px; padding: 20px; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); margin-bottom: 20px; border: 1px solid #e2e8f0;">
                <h3 style="color: #1e293b; font-size: 1.2rem; margin-bottom: 15px; display: flex; align-items: center; gap: 8px;">
                    üë• ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô (Admin)
                </h3>
                
                <div style="margin-bottom: 15px;">
                    <label style="color: #475569; font-size: 0.9rem; margin-bottom: 8px; display: block;">üëÅÔ∏è View as:</label>
                    <div style="position: relative;">
                        <select id="adminViewSelector" onchange="switchAdminView(this.value)" style="width: 100%; padding: 10px 15px; border-radius: 8px; border: 1px solid #cbd5e1; background: #f8fafc; color: #334155; appearance: none; font-size: 1rem;">
                            <!-- Populated by JS -->
                        </select>
                        <span style="position: absolute; right: 15px; top: 50%; transform: translateY(-50%); color: #64748b;">‚ñº</span>
                    </div>
                </div>

                <div style="display: flex; gap: 15px;">
                    <button onclick="openUserManagementModal()" style="flex: 1; background: linear-gradient(135deg, #6366f1, #8b5cf6); color: white; border: none; padding: 12px; border-radius: 8px; font-weight: 500; cursor: pointer; box-shadow: 0 4px 6px -1px rgba(99, 102, 241, 0.3);">
                        ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Users
                    </button>
                    <button onclick="logout()" style="flex: 1; background: white; color: #ef4444; border: 2px solid #ef4444; padding: 10px; border-radius: 8px; font-weight: 500; cursor: pointer;">
                        Log out
                    </button>
                </div>
            </div>

            <!-- Branch Management Card -->
            <div class="settings-section" id="settingsBranchSection" style="background: white; border-radius: 16px; padding: 20px; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); border: 1px solid #e2e8f0;">
                <h3 style="color: #1e293b; font-size: 1.2rem; margin-bottom: 5px; display: flex; align-items: center; gap: 8px;">
                    üè¢ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏≤‡∏Ç‡∏≤
                </h3>
                <p style="color: #64748b; font-size: 0.9rem; margin-bottom: 20px;">‡πÄ‡∏û‡∏¥‡πà‡∏° ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç ‡∏´‡∏£‡∏∑‡∏≠‡∏•‡∏ö‡∏™‡∏≤‡∏Ç‡∏≤‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</p>
                
                <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                    <input type="text" id="settingsBranchInput" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏™‡∏≤‡∏Ç‡∏≤ (‡πÄ‡∏ä‡πà‡∏ô B030)" style="flex: 1; padding: 12px; border: 1px solid #cbd5e1; border-radius: 8px; font-size: 1rem; background: #f8fafc;">
                    <button onclick="addCustomBranchFromSettings()" style="background: linear-gradient(135deg, #6366f1, #8b5cf6); color: white; border: none; padding: 12px 20px; border-radius: 8px; font-weight: 500; cursor: pointer; white-space: nowrap;">
                        + ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏≤‡∏Ç‡∏≤
                    </button>
                </div>

                <div class="custom-category-list" id="settingsBranchList" style="display: flex; flex-direction: column; gap: 10px;">
                    <!-- Will be populated by JS -->
                </div>
            </div>
            
            <!-- Category Management Card -->
             <div class="settings-section" id="settingsCategorySection" style="background: white; border-radius: 16px; padding: 20px; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); border: 1px solid #e2e8f0; margin-top: 20px;">
                <h3 style="color: #1e293b; font-size: 1.2rem; margin-bottom: 5px; display: flex; align-items: center; gap: 8px;">
                    üìÇ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà
                </h3>
                 <div class="category-input-group">
                    <div class="category-input-row">
                        <input type="text" id="settingsCategoryIcon" class="category-icon-input" placeholder="üìù" maxlength="2" style="font-size: 1.2rem;">
                        <input type="text" id="settingsCategoryName" class="category-name-input" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà" style="flex: 1; padding: 12px; font-size: 1rem;">
                        <button class="btn btn-primary" onclick="addCustomCategoryFromSettings()">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°</button>
                    </div>
                </div>
                <div class="custom-category-list" id="settingsCategoryList" style="margin-top: 15px;"></div>
             </div>

        </div>
    </div>

    <!-- User Permissions Modal -->
    <div class="edit-modal" id="userPermissionsModal" onclick="closeUserPermissionsModal(event)">
        <div class="edit-modal-content" onclick="event.stopPropagation()">
            <div class="edit-modal-header">
                <h3 class="edit-modal-title">üîí ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå: <span id="permissionsUsername"></span></h3>
                <button class="close-btn" onclick="closeUserPermissionsModal()">‚úï</button>
            </div>
            
            <div style="padding: 15px;">
                <div class="permission-item" style="margin-bottom: 10px; display: flex; align-items: center; justify-content: space-between; padding: 15px; background: var(--bg-main); border-radius: 12px; border: 1px solid var(--border);">
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <span style="font-size: 1.2rem;">üïò</span>
                        <div>
                            <div style="font-weight: 600;">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡∏á‡∏≤‡∏ô</div>
                            <div style="font-size: 0.8rem; color: var(--text-secondary);">‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏´‡πâ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤-‡∏≠‡∏≠‡∏Å‡∏á‡∏≤‡∏ô</div>
                        </div>
                    </div>
                    <label class="switch">
                        <input type="checkbox" id="perm_branch_visit">
                        <span class="slider round"></span>
                    </label>
                </div>

                <div class="permission-item" style="margin-bottom: 10px; display: flex; align-items: center; justify-content: space-between; padding: 15px; background: var(--bg-main); border-radius: 12px; border: 1px solid var(--border);">
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <span style="font-size: 1.2rem;">‚úÖ</span>
                        <div>
                            <div style="font-weight: 600;">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô (Manage Todos)</div>
                            <div style="font-size: 0.8rem; color: var(--text-secondary);">‡πÄ‡∏û‡∏¥‡πà‡∏°/‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç/‡∏•‡∏ö ‡∏á‡∏≤‡∏ô‡∏ï‡πà‡∏≤‡∏á‡πÜ</div>
                        </div>
                    </div>
                    <label class="switch">
                        <input type="checkbox" id="perm_manage_todo">
                        <span class="slider round"></span>
                    </label>
                </div>

                <div class="permission-item" style="margin-bottom: 10px; display: flex; align-items: center; justify-content: space-between; padding: 15px; background: var(--bg-main); border-radius: 12px; border: 1px solid var(--border);">
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <span style="font-size: 1.2rem;">üì§</span>
                        <div>
                            <div style="font-weight: 600;">Export ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</div>
                            <div style="font-size: 0.8rem; color: var(--text-secondary);">‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå Excel/CSV</div>
                        </div>
                    </div>
                    <label class="switch">
                        <input type="checkbox" id="perm_export_data">
                        <span class="slider round"></span>
                    </label>
                </div>
            </div>

            <div style="text-align: center; margin-top: 20px;">
                <button class="btn btn-primary" onclick="saveUserPermissions()" style="width: 100%; padding: 12px; font-size: 1rem;">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå</button>
            </div>
        </div>
    </div>

    <!-- Edit Branch Visit Modal -->
    <div class="edit-branch-modal" id="editBranchModal" onclick="closeEditBranchModal(event)">
        <div class="edit-branch-modal-content" onclick="event.stopPropagation()">
            <div class="edit-branch-modal-header">
                <h3 class="edit-branch-modal-title">‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÄ‡∏ß‡∏•‡∏≤‡∏á‡∏≤‡∏ô</h3>
                <button class="close-btn" onclick="closeEditBranchModal()">‚úï</button>
            </div>

            <div class="edit-branch-form-group">
                <label class="edit-branch-label">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label>
                <input type="date" id="editBranchVisitDate" class="edit-branch-input">
            </div>

            <div class="edit-branch-form-group" id="editBranchVisitBranchGroup" style="display: none;">
                <label class="edit-branch-label">‡∏™‡∏≤‡∏Ç‡∏≤</label>
                <select id="editBranchVisitBranch" class="edit-branch-input">
                    <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏≤‡∏Ç‡∏≤ --</option>
                </select>
            </div>

            <div class="edit-branch-form-group">
                <label class="edit-branch-label">‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤</label>
                <input type="time" id="editBranchVisitTime" class="edit-branch-input">
            </div>

            <div class="edit-branch-form-group">
                <label class="edit-branch-label">‡πÄ‡∏ß‡∏•‡∏≤‡∏≠‡∏≠‡∏Å</label>
                <input type="time" id="editBranchVisitTimeOut" class="edit-branch-input">
            </div>

            <div class="edit-branch-actions">
                <button class="btn btn-primary" onclick="saveEditedBranchVisit()" style="flex: 1;">
                    üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
                </button>
                <button class="btn" onclick="deleteEditedBranchVisit()" style="background: var(--danger); color: white;">
                    üóëÔ∏è ‡∏•‡∏ö
                </button>
                <button class="btn btn-secondary" onclick="closeEditBranchModal()">
                    ‚úï ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                </button>
            </div>
        </div>
    </div>

    <!-- Add Todo Modal -->
    <div class="edit-modal" id="addTodoModal" onclick="closeAddTodoModal(event)">
        <div class="edit-modal-content" onclick="event.stopPropagation()">
            <div class="edit-modal-header">
                <h3 class="edit-modal-title">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà</h3>
                <button class="close-btn" onclick="closeAddTodoModal()">‚úï</button>
            </div>

            <div class="edit-form-group">
                <label class="edit-form-label">‡∏ä‡∏∑‡πà‡∏≠‡∏á‡∏≤‡∏ô</label>
                <input type="text" id="addTodoText" class="edit-form-input" placeholder="‡πÉ‡∏™‡πà‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥...">
            </div>

            <div class="edit-form-group" id="addTodoCreatorGroup" style="display: none;">
                <label class="edit-form-label">‡∏ú‡∏π‡πâ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏á‡∏≤‡∏ô</label>
                <select id="addTodoCreatedBy" class="edit-form-select"></select>
            </div>

            <div class="edit-form-row">
                <div class="edit-form-group">
                    <label class="edit-form-label">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç</label>
                    <select id="addTodoPriority" class="edit-form-select">
                        <option value="high">üî¥ ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏°‡∏≤‡∏Å</option>
                        <option value="medium" selected>üü° ‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á</option>
                        <option value="low">üü¢ ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏ô‡πâ‡∏≠‡∏¢</option>
                    </select>
                </div>
                <div class="edit-form-group">
                    <label class="edit-form-label">‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</label>
                    <select id="addTodoCategory" class="edit-form-select">
                        <!-- Populated by JS -->
                    </select>
                </div>
            </div>

            <div class="edit-form-group">
                <label class="edit-form-label">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label>
                <input type="date" id="addTodoDate" class="edit-form-input">
            </div>

            <div class="edit-form-group">
                <label class="edit-form-label">‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤</label>
                <div class="edit-form-time-group">
                    <div>
                        <label class="edit-form-label" style="font-size: 0.8rem; margin-bottom: 4px;">‡πÄ‡∏£‡∏¥‡πà‡∏°</label>
                        <input type="time" id="addTodoTimeStart" class="edit-form-input">
                    </div>
                    <div>
                        <label class="edit-form-label" style="font-size: 0.8rem; margin-bottom: 4px;">‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î</label>
                        <input type="time" id="addTodoTimeEnd" class="edit-form-input">
                    </div>
                </div>
            </div>

            <div class="edit-form-group">
                <label class="edit-form-label">üè¢ ‡∏™‡∏≤‡∏Ç‡∏≤ (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ‡∏´‡∏•‡∏≤‡∏¢‡∏™‡∏≤‡∏Ç‡∏≤)</label>
                <div class="branch-grid" id="addBranchGrid">
                    <!-- Will be populated by JS -->
                </div>
            </div>

            <div class="edit-modal-actions">
                <button class="btn btn-primary" onclick="saveNewTodo()" style="flex: 1;">
                    ‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô
                </button>
                <button class="btn btn-secondary" onclick="closeAddTodoModal()">
                    ‚úï ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                </button>
            </div>
        </div>
    </div>

    </div><!-- Close container -->
    </div><!-- Close main-wrapper -->

    <!-- User Management Modal -->
    <div class="edit-modal" id="userManagementModal" onclick="closeUserManagementModal(event)">
        <div class="edit-modal-content" onclick="event.stopPropagation()">
            <div class="edit-modal-header">
                <h3 class="edit-modal-title">üë• ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</h3>
                <button class="close-btn" onclick="closeUserManagementModal()">‚úï</button>
            </div>
            
            <div style="margin-bottom: 20px; padding: 15px; background: var(--bg-main); border-radius: 12px; border: 1px solid var(--border);">
                <h4 style="margin-bottom: 10px;">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà</h4>
                <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                    <input type="text" id="newUsername" placeholder="Username" style="flex: 1; padding: 8px; border-radius: 6px; border: 1px solid var(--border);">
                    <input type="text" id="newDisplayName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô" style="flex: 1; padding: 8px; border-radius: 6px; border: 1px solid var(--border);">
                    <input type="password" id="newPassword" placeholder="Password" style="flex: 1; padding: 8px; border-radius: 6px; border: 1px solid var(--border);">
                    <select id="newUserRole" style="padding: 8px; border-radius: 6px; border: 1px solid var(--border);">
                        <option value="user">User</option>
                        <option value="admin">Admin</option>
                    </select>
                    <button class="btn btn-primary" onclick="addUser()">‡πÄ‡∏û‡∏¥‡πà‡∏°</button>
                </div>
            </div>

            <div style="max-height: 400px; overflow-y: auto;">
                <table style="width: 100%; border-collapse: collapse;">
                    <thead>
                        <tr style="text-align: left; border-bottom: 2px solid var(--border);">
                            <th style="padding: 10px;">Username</th>
                            <th style="padding: 10px;">‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô</th>
                            <th style="padding: 10px;">Role</th>
                            <th style="padding: 10px; text-align: right;">Action</th>
                        </tr>
                    </thead>
                    <tbody id="userListBody">
                        <!-- Populated by JS -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-analytics-compat.js"></script>
    <script src="firebase-config.js?v=20260203-4"></script>
    <script src="script.js?v=20260203-4"></script>
</body>
</html>
